
// 'use client';

// import { useState, useEffect, useMemo, useCallback } from 'react';
// import { Header, Breadcrumb } from '@/components/layout';
// import { StudentSelector, TranscriptOptions, TranscriptPreview } from '@/components/transcript';
// import { useStudents, useTranscript } from '@/hooks';
// import { 
//   Student, 
//   TranscriptOptions as TranscriptOptionsType, 
//   TranscriptData,
//   transformStudent,
//   transformTranscript,
// } from '@/types';

// const defaultOptions: TranscriptOptionsType = {
//   program: 'DP',
//   schoolYear: '2023/2024',
//   sessionType: 'May Session',
//   transcriptType: 'official',
//   includePredictedGrades: true,
// };

// export default function GenerateTranscriptPage() {
//   const [selectedStudent, setSelectedStudent] = useState<Student | null>(null);
//   const [transcriptOptions, setTranscriptOptions] = useState<TranscriptOptionsType>(defaultOptions);

//   // Fetch students from API
//   const { 
//     students: apiStudents, 
//     isLoading: studentsLoading, 
//     error: studentsError,
//     search: searchStudents,
//   } = useStudents();

//   // Fetch transcript when a student is selected
//   const {
//     transcript: apiTranscript,
//     isLoading: transcriptLoading,
//     error: transcriptError,
//   } = useTranscript(selectedStudent?.id || null);

//   // Transform API students to UI format
//   const students = useMemo(() => {
//     return apiStudents.map(transformStudent);
//   }, [apiStudents]);

//   // Transform API transcript to UI format
//   const transcriptData: TranscriptData | null = useMemo(() => {
//     if (!apiTranscript) return null;
//     return transformTranscript(apiTranscript);
//   }, [apiTranscript]);

//   // Handle student selection
//   const handleSelectStudent = useCallback((student: Student) => {
//     setSelectedStudent(student);
//   }, []);

//   // Handle search
//   const handleSearch = useCallback((query: string) => {
//     searchStudents(query);
//   }, [searchStudents]);

//   const handleGenerate = () => {
//     if (selectedStudent) {
//       console.log('Generating transcript for:', selectedStudent.name);
//       console.log('Options:', transcriptOptions);
//       alert(`Generating ${transcriptOptions.transcriptType} transcript for ${selectedStudent.name}`);
//     }
//   };

//   return (
//     <div className="min-h-screen bg-gradient-to-br from-slate-100 via-gray-100 to-slate-200">
//       {/* Header */}
//       <Header activeNav="generate-transcript" />
      
//       {/* Main Content Area */}
//       <main className="px-6 py-8">
//         <div className="max-w-7xl mx-auto">
//           {/* Breadcrumb */}
//           <Breadcrumb 
//             items={[
//               { label: 'Dashboard', href: '/dashboard' },
//               { label: 'Generate Transcript', href: null },
//             ]}
//           />
          
//           {/* Page Title */}
//           <h1 className="text-3xl font-bold text-gray-900 mb-8">
//             Generate Official Transcript
//           </h1>
          
//           {/* Content Grid */}
//           <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
//             {/* Left Column - Student Selection & Options */}
//             <div className="space-y-6">
//               {/* Student Selection */}
//               <StudentSelector
//                 students={students}
//                 selectedStudent={selectedStudent}
//                 onSelectStudent={handleSelectStudent}
//                 isLoading={studentsLoading}
//                 error={studentsError}
//                 onSearch={handleSearch}
//               />
              
//               {/* Transcript Options */}
//               <TranscriptOptions
//                 options={transcriptOptions}
//                 onOptionsChange={setTranscriptOptions}
//                 onGenerate={handleGenerate}
//                 isStudentSelected={selectedStudent !== null}
//               />
//             </div>
            
//             {/* Right Column - Transcript Preview */}
//             <TranscriptPreview 
//               data={transcriptData}
//               isLoading={transcriptLoading}
//               error={transcriptError}
//             />
//           </div>
          
//           {/* Footer Info */}
//           <div className="mt-8 flex items-center gap-8 text-sm text-gray-400">
//             <span>Audit Details: -</span>
//             <span>Generated By: Mr. Ed</span>
//           </div>
//         </div>
//       </main>
//     </div>
//   ); 
// } 



'use client';

import { useState, useMemo, useCallback } from 'react';
import { Header, Breadcrumb } from '@/components/layout';
import { StudentSelector, TranscriptOptions, TranscriptPreview } from '@/components/transcript';
import { ProtectedRoute } from '@/components/auth';
import { useStudents, useTranscript } from '@/hooks';
import { 
  Student, 
  TranscriptOptions as TranscriptOptionsType, 
  TranscriptData,
  transformStudent,
  transformTranscript,
} from '@/types';

const defaultOptions: TranscriptOptionsType = {
  program: 'DP',
  schoolYear: '2023/2024',
  sessionType: 'May Session',
  transcriptType: 'official',
  includePredictedGrades: true,
};

function GenerateTranscriptContent() {
  const [selectedStudent, setSelectedStudent] = useState<Student | null>(null);
  const [transcriptOptions, setTranscriptOptions] = useState<TranscriptOptionsType>(defaultOptions);

  // Fetch students from API
  const { 
    students: apiStudents, 
    isLoading: studentsLoading, 
    error: studentsError,
    search: searchStudents,
  } = useStudents();

  // Fetch transcript when a student is selected
  const {
    transcript: apiTranscript,
    isLoading: transcriptLoading,
    error: transcriptError,
  } = useTranscript(selectedStudent?.id || null);

  // Transform API students to UI format
  const students = useMemo(() => {
    return apiStudents.map(transformStudent);
  }, [apiStudents]);

  // Transform API transcript to UI format
  const transcriptData: TranscriptData | null = useMemo(() => {
    if (!apiTranscript) return null;
    return transformTranscript(apiTranscript);
  }, [apiTranscript]);

  // Handle student selection
  const handleSelectStudent = useCallback((student: Student) => {
    setSelectedStudent(student);
  }, []);

  // Handle search
  const handleSearch = useCallback((query: string) => {
    searchStudents(query);
  }, [searchStudents]);

  const handleGenerate = () => {
    if (selectedStudent) {
      console.log('Generating transcript for:', selectedStudent.name);
      console.log('Options:', transcriptOptions);
      alert(`Generating ${transcriptOptions.transcriptType} transcript for ${selectedStudent.name}`);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-100 via-gray-100 to-slate-200">
      {/* Header */}
      <Header activeNav="generate-transcript" />
      
      {/* Main Content Area */}
      <main className="px-6 py-8">
        <div className="max-w-7xl mx-auto">
          {/* Breadcrumb */}
          <Breadcrumb 
            items={[
              { label: 'Dashboard', href: '/dashboard' },
              { label: 'Generate Transcript', href: null },
            ]}
          />
          
          {/* Page Title */}
          <h1 className="text-3xl font-bold text-gray-900 mb-8">
            Generate Official Transcript
          </h1>
          
          {/* Content Grid */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Left Column - Student Selection & Options */}
            <div className="space-y-6">
              {/* Student Selection */}
              <StudentSelector
                students={students}
                selectedStudent={selectedStudent}
                onSelectStudent={handleSelectStudent}
                isLoading={studentsLoading}
                error={studentsError}
                onSearch={handleSearch}
              />
              
              {/* Transcript Options */}
              <TranscriptOptions
                options={transcriptOptions}
                onOptionsChange={setTranscriptOptions}
                onGenerate={handleGenerate}
                isStudentSelected={selectedStudent !== null}
              />
            </div>
            
            {/* Right Column - Transcript Preview */}
            <TranscriptPreview 
              data={transcriptData}
              isLoading={transcriptLoading}
              error={transcriptError}
            />
          </div>
          
          {/* Footer Info */}
          <div className="mt-8 flex items-center gap-8 text-sm text-gray-400">
            <span>Audit Details: -</span>
            <span>Generated By: Admin</span>
          </div>
        </div>
      </main>
    </div>
  );
}

export default function GenerateTranscriptPage() {
  return (
    <ProtectedRoute>
      <GenerateTranscriptContent />
    </ProtectedRoute>
  );
}